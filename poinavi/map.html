<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="ã½ã„ãƒŠãƒ“" />
    <meta name="theme-color" content="#ffffff" />
    <title>ã½ã„ãƒŠãƒ“ - åœ°å›³</title>
    <meta
      name="description"
      content="ç¾åœ¨åœ°ã‹ã‚‰è¿‘ã„åº—èˆ—ãƒ»ã‚¹ãƒãƒƒãƒˆã‚’ç›´æ„Ÿçš„ã«æ¤œç´¢ãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³"
    />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="apple-touch-icon" href="icon-192.png" />
    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" href="./style.css?v=22" />
    <!-- FOUCå¯¾ç­–: CSSãƒ­ãƒ¼ãƒ‰å‰ã«ãƒ†ãƒ¼ãƒã‚’é©ç”¨ -->
    <script>
      (function() {
        var theme = localStorage.getItem("poinavi_theme") || "light";
        document.documentElement.className = theme === "dark" ? "dark-mode" : "light-mode";
      })();
    </script>
    <style>
      /* FOUCå¯¾ç­–: åˆæœŸèƒŒæ™¯è‰² */
      html.light-mode { background-color: #f5f5f7; }
      html.dark-mode { background-color: #1a1a1a; }
    </style>
    <!-- Google Maps API -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDA62Ge5UHqpZOFQhMhVSvQI_xWABrftL0&libraries=places,geometry&callback=initGoogleMaps"
      defer
    ></script>
    <script>
      // Google Maps API ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      window.gm_authFailure = function() {
        showMapError("Google Maps API ã®èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚APIã‚­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      };

      // APIã‚­ãƒ¼ãƒã‚§ãƒƒã‚¯
      function checkApiKey() {
        const scriptTag = document.querySelector('script[src*="maps.googleapis.com"]');
        if (scriptTag && scriptTag.src.includes('YOUR_GOOGLE_MAPS_API_KEY')) {
          showMapError(
            "Google Maps API ã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n\n" +
            "map.html ã®14è¡Œç›®ä»˜è¿‘ã® YOUR_GOOGLE_MAPS_API_KEY ã‚’å®Ÿéš›ã®APIã‚­ãƒ¼ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚\n\n" +
            "APIã‚­ãƒ¼ã®å–å¾—æ–¹æ³•:\n" +
            "1. https://console.cloud.google.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹\n" +
            "2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ\n" +
            "3. Maps JavaScript API ã¨ Places API ã‚’æœ‰åŠ¹åŒ–\n" +
            "4. API ã‚­ãƒ¼ã‚’å–å¾—ã—ã¦è¨­å®š"
          );
          return false;
        }
        return true;
      }

      function showMapError(message) {
        const mapContainer = document.getElementById("map");
        if (mapContainer) {
          mapContainer.innerHTML = `
            <div style="
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              height: 100%;
              padding: 20px;
              text-align: center;
              background-color: #f5f5f5;
              color: #d32f2f;
            ">
              <div style="font-size: 48px; margin-bottom: 16px;">âš ï¸</div>
              <div style="font-size: 18px; font-weight: 600; margin-bottom: 12px;">ãƒãƒƒãƒ—ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</div>
              <div style="font-size: 14px; line-height: 1.6; white-space: pre-line;">${message}</div>
            </div>
          `;
        }
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«APIã‚­ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯
      window.addEventListener("DOMContentLoaded", function() {
        setTimeout(function() {
          if (typeof google === "undefined" || typeof google.maps === "undefined") {
            if (!checkApiKey()) {
              return;
            }
            showMapError(
              "Google Maps API ãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚\n\n" +
              "è€ƒãˆã‚‰ã‚Œã‚‹åŸå› :\n" +
              "ãƒ»APIã‚­ãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„\n" +
              "ãƒ»Maps JavaScript API ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ãªã„\n" +
              "ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®å•é¡Œ\n\n" +
              "ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
            );
          }
        }, 2000); // 2ç§’å¾Œã«ãƒã‚§ãƒƒã‚¯
      });
    </script>
  </head>
  <body>
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p class="loading-text">ç¾åœ¨åœ°ã‚’å–å¾—ä¸­...</p>
      </div>
    </div>

    <!-- ç¾åœ¨åœ°ä½æ‰€ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="locationModal" class="location-modal hidden">
      <div class="location-modal__overlay"></div>
      <div class="location-modal__content">
        <div class="location-modal__header">
          <h2 class="location-modal__title">ç¾åœ¨åœ°</h2>
          <button class="location-modal__close" id="locationModalClose" aria-label="é–‰ã˜ã‚‹">Ã—</button>
        </div>
        <div class="location-modal__body">
          <p class="location-modal__address" id="locationModalAddress">ä½æ‰€ã‚’å–å¾—ä¸­...</p>
        </div>
      </div>
    </div>

    <!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="settingsModal" class="settings-modal hidden">
      <div class="settings-modal__overlay"></div>
      <div class="settings-modal__content">
        <div class="settings-modal__header">
          <h2 class="settings-modal__title">è¨­å®š</h2>
          <button class="settings-modal__close" id="settingsModalClose" aria-label="é–‰ã˜ã‚‹">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="settings-modal__body">
          <!-- ã‚¿ã‚°ç®¡ç† -->
          <div class="settings-modal__item settings-modal__item--tags">
            <label class="settings-modal__label">ã‚¿ã‚°ç®¡ç†</label>
            
            <!-- ã‚¿ã‚°è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div class="tag-add-form">
              <input 
                type="text" 
                id="newTagInput" 
                class="tag-add-form__input" 
                placeholder="æ–°ã—ã„ã‚¿ã‚°å"
                maxlength="20"
              />
              <button id="addTagButton" class="tag-add-form__button" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                è¿½åŠ 
              </button>
            </div>
            
            <!-- ã‚¿ã‚°ä¸€è¦§ï¼ˆå‰Šé™¤å¯èƒ½ï¼‰ -->
            <div class="tag-manage-list" id="tagManageList">
              <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
            </div>
          </div>
          
          <!-- ç§»å‹•æ‰‹æ®µ -->
          <div class="settings-modal__item">
            <label class="settings-modal__label">ç§»å‹•æ‰‹æ®µ</label>
            <div class="transport-mode-buttons">
              <button type="button" class="transport-mode-btn active" data-mode="walk">
                ğŸš¶ å¾’æ­©
              </button>
              <button type="button" class="transport-mode-btn" data-mode="bicycle">
                ğŸš² è‡ªè»¢è»Š
              </button>
              <button type="button" class="transport-mode-btn" data-mode="car">
                ğŸš— è»Š
              </button>
            </div>
          </div>
          
          <!-- ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ -->
          <div class="settings-modal__item">
            <label class="settings-modal__label">ãƒ†ãƒ¼ãƒ</label>
            <button id="themeToggle" class="settings-modal__theme-toggle">
              <span class="theme-icon">ğŸŒ™</span>
              <span class="theme-text">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</span>
            </button>
          </div>
          
          <!-- è¡¨ç¤ºä»¶æ•° -->
          <div class="settings-modal__item">
            <label class="settings-modal__label">è¡¨ç¤ºä»¶æ•°</label>
            <select id="resultCount" class="settings-modal__select">
              <option value="3">3ä»¶</option>
              <option value="4">4ä»¶</option>
              <option value="5" selected>5ä»¶</option>
            </select>
          </div>
          
          <!-- å–¶æ¥­ä¸­ã®ã¿è¡¨ç¤º -->
          <div class="settings-modal__item">
            <label class="settings-modal__label settings-modal__label--checkbox">
              <input type="checkbox" id="openOnly" class="settings-modal__checkbox" />
              <span class="settings-modal__checkbox-custom"></span>
              å–¶æ¥­ä¸­ã®ã¿è¡¨ç¤º
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- 1ï¸âƒ£ ãƒãƒƒãƒ—è¡¨ç¤ºï¼ˆä¸Šéƒ¨ï¼‰ -->
    <main class="main-content">
      <div class="map-container">
        <div id="map" class="map"></div>
        
        <!-- è¨­å®šãƒœã‚¿ãƒ³ï¼ˆå³ä¸Šãƒ•ãƒ­ãƒ¼ãƒˆï¼‰ -->
        <button id="mapSettingsButton" class="map-settings-button" type="button" aria-label="è¨­å®š">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
        </button>
        
        <!-- ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆå·¦ä¸Šãƒ•ãƒ­ãƒ¼ãƒˆï¼‰ -->
        <div class="layer-control">
          <!-- é‰„é“ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒˆã‚°ãƒ« -->
          <button 
            id="railwayToggle" 
            class="layer-toggle" 
            type="button"
            aria-pressed="false"
            aria-label="é‰„é“è·¯ç·šåˆ‡æ›¿"
          >
            <svg class="layer-toggle__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="4" y="3" width="16" height="18" rx="2"></rect>
              <line x1="12" y1="8" x2="12" y2="21"></line>
              <line x1="8" y1="8" x2="8" y2="8.01"></line>
              <line x1="16" y1="8" x2="16" y2="8.01"></line>
              <path d="M4 11h16"></path>
              <circle cx="8.5" cy="15.5" r="1.5"></circle>
              <circle cx="15.5" cy="15.5" r="1.5"></circle>
            </svg>
            <span class="layer-toggle__text">é‰„é“</span>
          </button>
          
          <!-- é›¨é›²ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒˆã‚°ãƒ« -->
          <button 
            id="rainViewerToggle" 
            class="layer-toggle" 
            type="button"
            aria-pressed="false"
            aria-label="é›¨é›²ãƒ¬ãƒ¼ãƒ€ãƒ¼åˆ‡æ›¿"
          >
            <svg class="layer-toggle__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 17.58A5 5 0 0 0 18 8h-1.26A8 8 0 1 0 4 16.25"></path>
              <line x1="8" y1="16" x2="8.01" y2="16"></line>
              <line x1="8" y1="20" x2="8.01" y2="20"></line>
              <line x1="12" y1="18" x2="12.01" y2="18"></line>
              <line x1="12" y1="22" x2="12.01" y2="22"></line>
              <line x1="16" y1="16" x2="16.01" y2="16"></line>
              <line x1="16" y1="20" x2="16.01" y2="20"></line>
            </svg>
            <span class="layer-toggle__text">é›¨é›²</span>
          </button>
          
          <!-- é‰„é“ONæ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ‘ãƒãƒ« -->
          <div id="railwayStatus" class="layer-status hidden">
            <div class="layer-status__title">é‰„é“è·¯ç·šè¡¨ç¤ºä¸­</div>
            <div class="layer-status__desc">åŠå¾„10kmä»¥å†…ã®è·¯ç·šãƒ»é§…</div>
          </div>
          
          <!-- é›¨é›²ONæ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ‘ãƒãƒ« -->
          <div id="rainViewerStatus" class="layer-status hidden">
            <div class="layer-status__title">é›¨é›²è¦³æ¸¬ãƒ¢ãƒ¼ãƒ‰</div>
            <div class="layer-status__desc">é™é›¨çŠ¶æ³ã®å‚è€ƒè¡¨ç¤ºã§ã™</div>
          </div>
        </div>
        
        <!-- å…è²¬è¡¨ç¤ºï¼ˆå¸¸æ™‚ï¼‰ -->
        <div class="rain-viewer-disclaimer">
          â€» å¤©æ°—æƒ…å ±ã¯å‚è€ƒè¡¨ç¤ºã§ã™ã€‚å®Ÿéš›ã®çŠ¶æ³ã¯ç¾åœ°ã§ã”ç¢ºèªãã ã•ã„ã€‚
        </div>
        
        <!-- ãƒˆãƒƒãƒ—3ï½5ä»¶ãƒªã‚¹ãƒˆï¼ˆè·é›¢é †ï¼‰ -->
        <div class="results-list" id="resultsList"></div>
      </div>
    </main>

    <!-- 2ï¸âƒ£ è¨­å®šãƒãƒ¼ï¼ˆç”»é¢ä¸‹éƒ¨ãƒ»noteãƒãƒŠãƒ¼ã®ä¸Šï¼‰ -->
    <div class="settings-bar">
      <button class="settings-bar__toggle" id="settingsToggle" aria-label="è¨­å®šã‚’é–‹é–‰">
        <span class="settings-bar__toggle-icon">â–²</span>
      </button>
      <div class="settings-bar__inner" id="settingsContent">
        <!-- 1è¡Œç›®: æ¤œç´¢ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› -->
        <section class="settings-section">
          <div class="search-row">
            <div class="search-group">
              <input
                type="text"
                id="searchInput"
                class="search-input"
                placeholder="ç ”ç©¶æ‰€"
              />
            <button id="searchButton" class="search-button" type="button" aria-label="æ¤œç´¢">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </button>
            </div>
          </div>
        </section>

        <!-- 2è¡Œç›®: ã‚¿ã‚°é¸æŠï¼ˆJavaScriptã§å‹•çš„ã«ç”Ÿæˆï¼‰ -->
        <section class="settings-section">
          <div class="tag-list" id="tagList">
            <!-- ã‚¿ã‚°ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
          </div>
        </section>
      </div>
    </div>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="translate-footer">
      <a href="./index.html" class="translate-footer__btn" aria-label="ãƒ¡ãƒ¢ãƒšãƒ¼ã‚¸ã¸">
        <!-- ãƒ¡ãƒ¢ã‚¢ã‚¤ã‚³ãƒ³ -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
          <polyline points="10 9 9 9 8 9"/>
        </svg>
        <span class="translate-footer__label">ãƒ¡ãƒ¢</span>
      </a>
      <a
        href="https://note.com/pointlab"
        target="_blank"
        rel="noopener noreferrer"
        class="translate-footer__banner"
      >
        <img src="./poyonkun_full.png" alt="ã½ã„ãµã‚‹" class="translate-footer__banner-icon" />
        <span>ã½ã„ã‚“ã¨ã‚‰ã¼</span>
      </a>
      <div class="translate-footer__btn translate-footer__btn--invisible" aria-hidden="true">
        <!-- åœ°å›³ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆä¸å¯è¦–ï¼‰ -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/>
          <line x1="8" y1="2" x2="8" y2="18"/>
          <line x1="16" y1="6" x2="16" y2="22"/>
        </svg>
        <span class="translate-footer__label">åœ°å›³</span>
      </div>
    </footer>

    <script src="./script.js?v=20"></script>
  </body>
</html>
