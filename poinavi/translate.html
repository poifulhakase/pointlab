<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="ぽいナビ" />
    <meta name="theme-color" content="#ffffff" />
    <title>ぽいナビ - 翻訳</title>
    <meta name="description" content="音声翻訳とカメラ翻訳で旅行をサポート" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="apple-touch-icon" href="icon-192.png" />
    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" href="./style.css?v=67" />
    <!-- FOUC対策: CSSロード前にテーマを適用 -->
    <script>
      (function() {
        var theme = localStorage.getItem("poinavi_theme") || "light";
        document.documentElement.className = theme === "dark" ? "dark-mode" : "light-mode";
      })();
    </script>
    <style>
      /* FOUC対策: 初期背景色 */
      html.light-mode { background-color: #f5f5f7; }
      html.dark-mode { background-color: #1a1a1a; }
    </style>
  </head>
  <body>
    <!-- ヘッダー -->
    <header class="translate-header">
      <!-- 左側のスペーサー -->
      <div class="translate-header__icon-btn translate-header__icon-btn--invisible"></div>
      
      <h1 class="translate-header__title">
        <img src="./logo.svg" alt="ぽいナビ" class="translate-header__logo" />
      </h1>
      
      <!-- 設定ボタン（右上） -->
      <button id="translateSettingsButton" class="translate-header__icon-btn translate-header__icon-btn--right" type="button" aria-label="設定">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </button>
    </header>

    <!-- 設定モーダル -->
    <div id="translateSettingsModal" class="translate-modal hidden">
      <div class="translate-modal__overlay"></div>
      <div class="translate-modal__content">
        <div class="translate-modal__header">
          <h2 class="translate-modal__title">設定</h2>
          <button class="translate-modal__close" id="translateSettingsClose" aria-label="閉じる">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="translate-modal__body">
          <!-- 音声セクション -->
          <div class="translate-modal__section">
            <div class="translate-modal__section-title">音声</div>
            <div class="translate-modal__item">
              <label class="translate-modal__label">翻訳前</label>
              <select id="micInputLangSelect" class="translate-modal__select">
                <option value="ja">日本語</option>
                <option value="en" selected>英語</option>
                <option value="zh">中国語</option>
                <option value="ko">韓国語</option>
                <option value="fr">フランス語</option>
                <option value="de">ドイツ語</option>
                <option value="es">スペイン語</option>
                <option value="it">イタリア語</option>
                <option value="pt">ポルトガル語</option>
                <option value="ru">ロシア語</option>
                <option value="th">タイ語</option>
                <option value="vi">ベトナム語</option>
              </select>
            </div>
            <div class="translate-modal__item">
              <label class="translate-modal__label">翻訳後</label>
              <select id="micTargetLangSelect" class="translate-modal__select">
                <option value="en">英語</option>
                <option value="ja" selected>日本語</option>
                <option value="zh">中国語</option>
                <option value="ko">韓国語</option>
                <option value="fr">フランス語</option>
                <option value="de">ドイツ語</option>
                <option value="es">スペイン語</option>
                <option value="it">イタリア語</option>
                <option value="pt">ポルトガル語</option>
                <option value="ru">ロシア語</option>
                <option value="th">タイ語</option>
                <option value="vi">ベトナム語</option>
              </select>
            </div>
          </div>
          
          <!-- カメラセクション -->
          <div class="translate-modal__section">
            <div class="translate-modal__section-title">カメラ</div>
            <div class="translate-modal__item">
              <label class="translate-modal__label">翻訳前</label>
              <select id="ocrLanguageSelect" class="translate-modal__select">
                <option value="jpn">日本語</option>
                <option value="eng" selected>英語</option>
                <option value="chi_sim">中国語（簡体）</option>
                <option value="chi_tra">中国語（繁体）</option>
                <option value="kor">韓国語</option>
                <option value="fra">フランス語</option>
                <option value="deu">ドイツ語</option>
                <option value="spa">スペイン語</option>
                <option value="ita">イタリア語</option>
                <option value="por">ポルトガル語</option>
                <option value="rus">ロシア語</option>
                <option value="tha">タイ語</option>
                <option value="vie">ベトナム語</option>
              </select>
            </div>
            <div class="translate-modal__item">
              <label class="translate-modal__label">翻訳後</label>
              <select id="translateTargetLang" class="translate-modal__select">
                <option value="en">英語</option>
                <option value="ja" selected>日本語</option>
                <option value="zh">中国語</option>
                <option value="ko">韓国語</option>
                <option value="fr">フランス語</option>
                <option value="de">ドイツ語</option>
                <option value="es">スペイン語</option>
                <option value="it">イタリア語</option>
                <option value="pt">ポルトガル語</option>
                <option value="ru">ロシア語</option>
                <option value="th">タイ語</option>
                <option value="vi">ベトナム語</option>
              </select>
            </div>
          </div>
          
          <!-- 起動ページセクション -->
          <div class="translate-modal__section">
            <div class="translate-modal__section-title">起動時のページ</div>
            <select id="translateStartPageSelect" class="translate-modal__select">
              <option value="index.html">メモ</option>
              <option value="translate.html">翻訳</option>
              <option value="map.html">地図</option>
            </select>
          </div>

          <!-- テーマセクション -->
          <div class="translate-modal__section">
            <div class="translate-modal__section-title">テーマ</div>
            <button id="translateThemeToggle" class="translate-modal__theme-toggle">
              <span class="theme-icon">☀️</span>
              <span class="theme-text">ライトモード</span>
            </button>
          </div>
          <!-- 免責事項セクション -->
          <div class="translate-modal__section">
            <div class="translate-modal__section-title">免責事項</div>
            <div class="settings-modal__disclaimer-text">
              <p>本サービス「ぽいナビ」は、AIによる参考情報を提供するものです。</p>
              <ul>
                <li>翻訳結果は参考情報であり、正確性・完全性を保証するものではありません</li>
                <li>重要な場面では、プロの通訳や翻訳者への相談を推奨いたします</li>
                <li>本サービスの利用により生じた損害について、運営者は一切の責任を負いません</li>
              </ul>
            </div>
          </div>
          <!-- 設定初期化セクション -->
          <div class="translate-modal__section">
            <button id="translateResetBtn" class="settings-modal__reset-btn" type="button">
              設定を初期化
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- カメラ撮影モーダル -->
    <div id="cameraModal" class="camera-modal hidden">
      <div class="camera-modal__container">
        <!-- カメラプレビュー画面 -->
        <div id="cameraPreviewScreen" class="camera-modal__screen">
          <div class="camera-modal__header">
            <button class="camera-modal__close-btn" id="cameraCloseBtn" aria-label="閉じる">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
            <span class="camera-modal__title">カメラ翻訳</span>
            <div class="camera-modal__spacer"></div>
          </div>
          <div class="camera-modal__video-wrapper">
            <video id="cameraVideo" autoplay playsinline></video>
            <div class="camera-modal__guide">
              <div class="camera-modal__guide-corner camera-modal__guide-corner--tl"></div>
              <div class="camera-modal__guide-corner camera-modal__guide-corner--tr"></div>
              <div class="camera-modal__guide-corner camera-modal__guide-corner--bl"></div>
              <div class="camera-modal__guide-corner camera-modal__guide-corner--br"></div>
            </div>
          </div>
          <div class="camera-modal__controls">
            <button class="camera-modal__capture-btn" id="cameraCaptureBtn" aria-label="撮影">
              <span class="camera-modal__capture-inner"></span>
            </button>
          </div>
          <p class="camera-modal__hint">翻訳したい文字を枠内に収めて撮影</p>
        </div>

        <!-- 範囲選択画面 -->
        <div id="cropScreen" class="camera-modal__screen hidden">
          <div class="camera-modal__header">
            <button class="camera-modal__back-btn" id="cropBackBtn" aria-label="戻る">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <span class="camera-modal__title">範囲を選択</span>
            <button class="camera-modal__done-btn" id="cropDoneBtn">完了</button>
          </div>
          <div class="camera-modal__crop-wrapper" id="cropWrapper">
            <canvas id="capturedCanvas"></canvas>
            <div class="camera-modal__crop-overlay" id="cropOverlay">
              <div class="camera-modal__crop-box" id="cropBox">
                <div class="crop-handle crop-handle--nw" data-handle="nw"></div>
                <div class="crop-handle crop-handle--ne" data-handle="ne"></div>
                <div class="crop-handle crop-handle--sw" data-handle="sw"></div>
                <div class="crop-handle crop-handle--se" data-handle="se"></div>
                <div class="crop-handle crop-handle--n" data-handle="n"></div>
                <div class="crop-handle crop-handle--s" data-handle="s"></div>
                <div class="crop-handle crop-handle--w" data-handle="w"></div>
                <div class="crop-handle crop-handle--e" data-handle="e"></div>
              </div>
            </div>
          </div>
          <p class="camera-modal__hint">ドラッグして翻訳したい範囲を調整</p>
        </div>

        <!-- OCR処理中画面 -->
        <div id="ocrProcessingScreen" class="camera-modal__screen hidden">
          <div class="camera-modal__processing">
            <div class="camera-modal__spinner"></div>
            <p class="camera-modal__processing-text" id="processingText">文字を認識中...</p>
            <div class="camera-modal__progress-bar">
              <div class="camera-modal__progress-fill" id="ocrProgressFill"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- メインコンテンツ -->
    <main class="translate-main">
      <!-- テキスト表示エリア -->
      <div class="translate-result-area" id="translateResultArea">
        <div class="translate-result-placeholder">
          <p>翻訳結果がここに表示されます</p>
        </div>
      </div>

      <!-- カメラ翻訳エリア -->
      <div class="translate-camera-area">
        <div class="translate-camera-area__buttons">
          <!-- リセットボタン -->
          <div class="translate-camera-area__btn-wrapper">
            <button class="translate-camera-btn translate-reset-btn" id="resetTranslateBtn" type="button" aria-label="リセット">
              <svg class="translate-camera-btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
              </svg>
            </button>
          </div>
          <!-- カメラ翻訳ボタン -->
          <div class="translate-camera-area__btn-wrapper">
            <button class="translate-camera-btn" id="cameraTranslateBtn" type="button" aria-label="カメラ翻訳">
              <svg class="translate-camera-btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
              </svg>
            </button>
            <p class="translate-camera-label">カメラ翻訳</p>
          </div>
        </div>
      </div>

      <!-- 音声翻訳ボタン（中央大きめの丸ボタン） -->
      <div class="translate-voice-area">
        <button class="translate-voice-btn" id="voiceTranslateBtn" type="button" aria-label="音声翻訳">
          <svg class="translate-voice-btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
            <line x1="12" y1="19" x2="12" y2="23"></line>
            <line x1="8" y1="23" x2="16" y2="23"></line>
          </svg>
        </button>
        <p class="translate-voice-label">音声翻訳</p>
      </div>
    </main>

    <!-- フッター -->
    <footer class="translate-footer">
      <a href="./index.html?from=nav" class="translate-footer__btn" aria-label="メモページへ">
        <!-- メモアイコン -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
          <polyline points="10 9 9 9 8 9"/>
        </svg>
        <span class="translate-footer__label">メモ</span>
      </a>
      <a
        href="https://note.com/pointlab/magazines"
        target="_blank"
        rel="noopener noreferrer"
        class="translate-footer__banner"
      >
        <img src="./poyonkun_full.png" alt="ぽいんとらぼ" class="translate-footer__logo" />
      </a>
      <a href="./map.html" class="translate-footer__btn" aria-label="地図ページへ">
        <!-- 地図アイコン -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/>
          <line x1="8" y1="2" x2="8" y2="18"/>
          <line x1="16" y1="6" x2="16" y2="22"/>
        </svg>
        <span class="translate-footer__label">地図</span>
      </a>
    </footer>

    <!-- Tesseract.js OCRライブラリ（unpkg CDNを使用） -->
    <script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
    <script src="./translate.js?v=61"></script>
  </body>
</html>
